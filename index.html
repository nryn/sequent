<?xml version="1.0" encoding="UTF-8"?>
<html>
  <head>
    <script src="note.js"></script>
    <script src="bar.js"></script>
    <script src="phrase.js"></script>
    <script src="song.js"></script>
    <script src="playbackVisualiser.js"></script>
    <script src="sequencer.js"></script>
    <script src="player.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Comfortaa&amp;subset=latin-ext" rel="stylesheet">
    <link rel="stylesheet" href="./styles.css">
    <script>
    function createSong() {
      const mySong = new Song();
      const myPhrase = new Phrase();
      const bOne = new Bar();
      const bTwo = new Bar();
      const bThree = new Bar(3,4);
      const trumpetC = new Note("Trumpet", "C", 2, 4);
      const vLongVocalG = new Note("Vocal", "G", 2, 1);
      const vShortPiccoloA = new Note("Piccolo", "A", 2, 16);
      const bassoonC = new Note("Bassoon", "C", 2, 4);
      const shortPercE = new Note("Percussion", "E", 2, 8);
      const shortViolinD = new Note("Violin", "D", 2, 8);
      const celloA = new Note("Cello", "A", 2, 4);
      const long808Bb = new Note("808", "Bb", 2, 2);
      const vShortSynthFs = new Note("Synth", "F#", 2, 16);
      const shortSamplerC = new Note("Sampler", "C", 2, 8);
      const vLongGuitarB = new Note("Guitar", "B", 2, 1);
      const longShamisenG = new Note("Shamisen", "G", 2, 2);
      myPhrase.addBar(bOne, bTwo, bThree);
      mySong.addPhrase(myPhrase);
      bOne.beats[1][1].push(vLongVocalG);
      bOne.beats[1][2].push(vShortSynthFs);
      bOne.beats[1][3].push(longShamisenG);
      bOne.beats[1][4].push(shortSamplerC);
      bOne.beats[2][1].push(trumpetC);
      bOne.beats[2][2].push(bassoonC);
      bOne.beats[2][3].push(vShortPiccoloA);
      bOne.beats[2][4].push(shortPercE);
      bOne.beats[3][1].push(celloA);
      bOne.beats[4][1].push(shortViolinD);
      bTwo.beats[2][1].push(vLongGuitarB);
      bTwo.beats[4][1].push(long808Bb);
      bThree.beats[1][1].push(vShortSynthFs);
      const mySecondPhrase = new Phrase();
      mySong.addPhrase(mySecondPhrase);
      mySecondPhrase.addBar(bThree);
      mySong.duplicatePhrase('A');
      return mySong;
    };

    let exampleSong = createSong(); // before we have our own sequencer to make songs effectively, this example song should be available globally shortly after page load
    const sequentPlayer = new Player();

    </script>
  </head>
  <body>
    <div id="container">
      <h1>sequent</h1>
      <div id ="workspace-controls">
        <button id="left-workspace-button" onClick="sequentPlayer.play();">▶</button>
        <div id="workspace-toggle">
          <label class="switch">
            <input type="checkbox" id="workspace-toggle-switch">
            <span class="slider round" text-after="playback" text-before="sequencer"></span>
          </label>
        </div>
        <button id="right-workspace-button" onClick="sequentPlayer.toggleSongDialogue('load');">▼</button>
      </div>
      <div id="create-song-dialogue-box" class="collapsed">
        <div id="overwrite-dialogue-box" class="collpased">
          <div id ="dialogue-text">
            <p>creating a new song.</p>
            <p>any unsaved changes to your current song will be lost.</p>
            <hr>
          </div>
        </div>
        <div id ="dialogue-text">
          <form id="create-song-form">
            <label for="song-name">song name : </label>
            <input type="text" id="song-name" placeholder="The Best Song in the World">
            <label for="tempo-input">tempo : <span id="tempo-value"></span></label>
            <input type="range" id="tempo-input" min="60" max="150" step="5">
            <button type="button" id="create-sqnt-button" onClick="sequentPlayer.sequencer.createSongFromForm()">create song</button>
          </form>
          <hr>
        </div>
      </div>
      <div id="load-song-dialogue-box" class="collapsed">
        <div id ="dialogue-text">
          <textarea id="load-sqnt-textarea" placeholder="If you have a previously-saved .sqnt.txt file, please paste its contents in this text box."></textarea>
          <button id="load-sqnt-button" onClick="sequentPlayer.unpackEncodedSong()">load</button>
          <hr>
        </div>
      </div>
      <div id="workspaces">
        <div id="playback-workspace" class="playback workspace">
          <table id="playback-grid" class="collapsed"></table>
        </div>
        <div id="sequencer-workspace" class="sequencer workspace">
          <div id="sequencer-song-controls" class="sequencer song-controls">
            <div id="sequencer-title" class="sequencer title"></div>
            <div id="sequencer-transport-bar" class="sequencer transport-bar">
              <div id="sequencer-transport-bar-section-controls">
                <select id="sequencer-transport-bar-section-selector"></select>
                <button onClick="sequentPlayer.sequencer.addPhrase();">✚</button>
                <button onClick="sequentPlayer.sequencer.removePhrase();">✖</button>
              </div>
              <div id="sequencer-transport-bar-instrument-controls">
                <select id="sequencer-transport-bar-instrument-selector"></select>
                <button onClick="sequentPlayer.sequencer.addInstrument();">✚</button>
                <button onClick="sequentPlayer.sequencer.removeInstrument();">✖</button>
              </div>
              <button onClick="sequentPlayer.sequencer.playPhrase();">▶</button>
              <button onClick="sequentPlayer.sequencer.saveSong();">save</button>
              <button onClick="sequentPlayer.sequencer.addBarToSong();">add bar</button>
            </div>
          </div>
          <table id="sequencer-grid" class="collapsed"></table>
        </div>
      </div>
    </div>
    <script async="true">
      let workspaceToggle = document.getElementById("workspace-toggle-switch");
      let workspaceContainer = document.getElementById("workspaces");
      let playbackWorkspace = document.getElementById("playback-workspace");
      let sequencerWorkspace = document.getElementById("sequencer-workspace");
      let leftWorkspaceButton = document.getElementById("left-workspace-button");
      workspaceToggle.addEventListener("change", swipeToWorkspace, false);
      function swipeToWorkspace() {
        if (workspaceToggle.checked) {
          // go right
          leftWorkspaceButton.innerHTML = "✚";
          leftWorkspaceButton.removeAttribute("onclick")
          leftWorkspaceButton.setAttribute("onclick", "sequentPlayer.toggleSongDialogue('create');")
          workspaceContainer.style.marginLeft = "-50%";
          workspaceContainer.style.marginRight = "0%";
          playbackWorkspace.style.opacity = "0";
          sequencerWorkspace.style.opacity = "1";
        } else {
          leftWorkspaceButton.innerHTML = "▶";
          leftWorkspaceButton.removeAttribute("onclick")
          leftWorkspaceButton.setAttribute("onclick", "sequentPlayer.play();")
          workspaceContainer.style.marginLeft = "0%";
          workspaceContainer.style.marginRight = "-50%";
          playbackWorkspace.style.opacity = "1";
          sequencerWorkspace.style.opacity = "0";
        };
      };
      let loadDialogue = document.getElementById('load-song-dialogue-box');
      let createDialogue = document.getElementById('create-song-dialogue-box');
      collapseSongDialogueArea(loadDialogue);
      collapseSongDialogueArea(createDialogue);

      let slider = document.getElementById("tempo-input");
      let output = document.getElementById("tempo-value");
      slider.defaultValue = 120;
      output.innerHTML = slider.value;
      slider.oninput = function() {
          output.innerHTML = this.value;
      }
    </script>
  </body>
</html>
